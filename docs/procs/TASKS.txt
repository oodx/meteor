# METEOR ENGINE TASK BOARD

## 🎯 CURRENT FOCUS (2025-09-28)
- Roadmap: `docs/procs/ROADMAP.txt` — ME-1 ✅ COMPLETE → ME-2 ✅ COMPLETE → ME-3 in progress.
- Architecture references: `docs/ref/architecture/ENGINE_ENHANCEMENT.md`, `docs/ref/planning/ENGINE_TASKS.txt`.
- **ME-1 Status**: ✅ DELIVERED (8/8 SP, 100%) - Workspace foundations complete.
- **ME-2 Status**: ✅ DELIVERED (7/7 SP, 100%) - Iterators, NamespaceView, Cursor Guards complete.
- **ME-3 Status**: ✅ COMPLETED (18/18 SP) – ENG-20 (Aggregation), ENG-21 (Section Emission), ENG-22 (Export), ENG-23 (Import), ENG-24 (Scratch Slots), ENG-40 (Constructor Hardening), ENG-41 (Parser Alignment), ENG-42 (Smart Split), CLI-05 / REPL-05 (View adoption), QA-10 (Zero-warning baseline).
- **Current Test Count**: 365 total tests passing (100 lib + 256 integration + 9 doc tests)
- **Next Phase**: Continue ME-3 (ENG-40 through QA-10) - Constructor hardening, parser alignment, CLI/REPL integration.

Legends: Status — 🔵 Ready, 🟠 In Progress, ⚪ Planned. Owner marked when a driver is assigned.

---

## 🧱 ME-1 — WORKSPACE FOUNDATIONS (8 SP)

| Ticket | SP | Status | Owner | Dependencies | Acceptance Snapshot |
|--------|----|--------|-------|--------------|---------------------|
| ENG-01 | 3 | ✅ Complete | - | None | Workspace struct wired into `MeteorEngine`; ordering, caches, scratch buffers stored per `(ctx, ns)`. |
| ENG-02 | 2 | ✅ Complete | - | ENG-01 | All mutation paths trigger cache invalidation; tests cover success & error flows. |
| ENG-03 | 1 | ✅ Complete | - | ENG-01 | Debug-only workspace dump behind `cfg(debug_assertions)` with snapshot test. |
| REGR-03 | 2 | ✅ Complete | - | ENG-01 | Namespace depth guard respects profile overrides; regression suite green in strict + relaxed modes. |

**ENG-01 (3 SP)** ✅ **COMPLETED** (2025-10-03)
- ✅ Delivered `EngineWorkspace` owning ordering tables, query caches, scratch slots keyed by `(context, namespace)`.
- ✅ Integrated with `MeteorEngine` lifecycle (init, clone, reset) without leaking through public API.
- ✅ Added 12 unit tests for workspace creation, cache invalidation, and scratch-slot reservation.
- ✅ Implementation: `src/lib/types/meteor/workspace.rs` (202 LOC implementation + 206 LOC tests)
- ✅ Test results: All 176 tests passing (105 lib + 71 integration, 100% pass rate)
- ✅ **Fix**: Added `EngineWorkspace::clear()` to properly align workspace with `StorageData` during `clear_storage()` and `reset_all()` operations
- ✅ Added regression tests: `tests/test_workspace_storage_alignment.rs` (3 tests validating workspace-storage alignment)

**ENG-02 (2 SP)** ✅ **COMPLETED** (2025-10-03)
- ✅ Extended all mutation methods (`store_token`, `store_token_at`, `set`, `delete`) to update workspace key_order
- ✅ Implemented scope-aware invalidation (key/namespace/context/storage levels)
- ✅ **Fixed**: Added `invalidate_caches()` calls on all insert/update/delete paths to prevent stale query cache
- ✅ Added `workspace-instrumentation` feature flag with cache hit/miss tracking
- ✅ Instrumentation includes: `cache_hits`, `cache_misses`, `cache_hit_ratio()` per namespace
- ✅ Counters automatically reset on cache invalidation
- ✅ Test results: 24 tests (14 mutation + 10 cache invalidation), all passing
- ✅ **China's Review**: Production Ready - comprehensive mutation hooks, solid invalidation logic
- ✅ Files modified: `Cargo.toml`, `workspace.rs` (+70 LOC), `engine.rs` (4 invalidation calls added), test suite (+390 LOC)

**ENG-03 (1 SP)** ✅ **COMPLETED** (2025-10-03)
- ✅ `workspace_status()` method already implemented in ENG-01 (returns `WorkspaceStatus` struct)
- ✅ Added comprehensive documentation to `ENGINE_ENHANCEMENT.md` with:
  - Full `WorkspaceStatus` struct definition with field descriptions
  - Complete usage example with debug assertions and feature flag handling
  - 5 guard rails documented (debug-only, read-only, feature flags, atomic invalidation, encapsulation)
  - Cache invalidation semantics for all mutation paths
  - Performance monitoring instructions for ME-2 testing
- ✅ Documentation includes workspace inspection section (~80 lines) with guard rails and examples
- ✅ All 203 tests passing (no changes to implementation, documentation-only ticket)

**REGR-03 (2 SP)** ✅ **COMPLETED** (2025-10-03)
- ✅ Created comprehensive regression test suite: `tests/test_namespace_depth_regression.rs` (13 tests, 298 LOC)
- ✅ Profile-aware tests validate all 4 profiles: default, enterprise, embedded, strict
- ✅ Test coverage includes:
  - Clear/warning/error threshold validation
  - Progressive depth validation (1-10 levels)
  - Profile-specific boundary tests (cfg attributes)
  - Edge case testing (max_depth - 1)
  - Real-world namespace pattern validation
  - Integration with MeteorEngine
- ✅ Fixed cfg(meteor_default) warning by adding meteor_default to build.rs check-cfg declarations
- ✅ Created GitHub Actions CI workflow: `.github/workflows/profile-regression.yml`
  - Matrix testing across all 4 profiles
  - Automatic rebuild with METEOR_PROFILE env var
  - Profile configuration display for debugging
  - Lint/clippy checks on default profile
- ✅ Comprehensive testing guide: `docs/PROFILE_TESTING.md` (~300 lines)
  - Local testing instructions with examples
  - CI simulation scripts
  - Profile-aware test writing patterns
  - Troubleshooting guide
  - Best practices for downstream consumers
- ✅ All 13 regression tests pass in default profile
- ✅ Namespace depth validation respects compile-time profile overrides via NAMESPACE_ERROR_DEPTH/NAMESPACE_WARNING_DEPTH constants

---

## 🔄 ME-2 — ITERATORS & CURSOR GUARDS (7 SP)

| Ticket | SP | Status | Owner | Dependencies | Acceptance Snapshot |
|--------|----|--------|-------|--------------|---------------------|
| ENG-10 | 2 | ✅ Complete | - | ME-1 | `iter_entries`, `contexts_iter`, `namespaces_iter` cover hybrid storage with ordering hints. |
| ENG-11 | 2 | ✅ Complete | - | ENG-10 | Namespace view struct exposes counts/default markers with ordered iteration methods. |
| ENG-12 | 3 | ✅ Complete | - | ENG-10 | `cursor()` accessor and `CursorGuard` RAII provide safe cursor state management with panic/error restoration. |

**ENG-10 (2 SP)** ✅ **COMPLETED** (2025-10-03)
- ✅ Implemented `contexts_iter()` - iterator over sorted context names
- ✅ Implemented `namespaces_iter(context)` - iterator over sorted namespace names within context
- ✅ Implemented `iter_entries()` - iterator over all entries with workspace ordering
  - Returns `EntriesIterator<'_>` yielding `(String, String, String, String)` tuples
  - Leverages workspace `key_order` for deterministic insertion-order iteration
  - Falls back to storage keys when workspace unavailable (hybrid storage support)
  - Explicit lifetime annotation (`'_`) for clear borrowing semantics
- ✅ Added 17 comprehensive unit tests (`tests/test_engine_iterators.rs`, 249 LOC):
  - Context/namespace iterator edge cases (empty, single, multiple)
  - Entry iteration across contexts/namespaces
  - Workspace ordering preservation (insertion order, NOT alphabetical)
  - Post-deletion consistency
  - Update ordering stability
- ✅ Added iteration instrumentation (feature-gated):
  - `iteration_count`, `keys_iterated` per namespace
  - `total_iterations`, `total_keys_iterated`, `avg_keys_per_iteration` in WorkspaceStatus
  - `record_iteration()`, `avg_keys_per_iteration()` methods
- ✅ Comprehensive documentation in `ENGINE_ENHANCEMENT.md` (~180 lines):
  - API surface with examples
  - Implementation details and algorithm
  - Workspace integration strategy
  - Performance characteristics (time/space complexity)
  - Lifetime and borrowing semantics
  - Test coverage summary
- ✅ All 252 tests passing (234 existing + 17 new + 1 doc test)
- ✅ **Bug Fix** (2025-10-03): Fixed instrumentation bug where `record_iteration()` was never called
  - Changed counters from `u64` to `Cell<u64>` for interior mutability
  - `EntriesIterator` now calls `workspace.record_iteration()` when using `key_order`
  - Implemented manual `Clone` for `NamespaceWorkspace` to handle `Cell` fields
  - Added 6 instrumentation tests (`tests/test_iteration_instrumentation.rs`)
  - Iteration metrics now persist across cache invalidations (lifetime statistics)

**ENG-11 (2 SP)** ✅ **COMPLETED** (2025-09-27)
- ✅ Implemented `namespace_view(context, namespace)` returning `Option<NamespaceView<'_>>`
- ✅ Created `NamespaceView` struct with public metadata:
  - `context: String` - context name
  - `namespace: String` - namespace path
  - `entry_count: usize` - total keys in namespace
  - `has_default: bool` - `.index` key detection for directory-style namespaces
- ✅ Implemented iterator methods (all with workspace ordering):
  - `entries()` - iterator over `(String, String)` key-value pairs
  - `keys()` - iterator over `&str` keys
  - `values()` - iterator over `String` values
- ✅ Implemented access methods:
  - `get(key)` - single key access without iteration
  - `has_key(key)` - key existence check
  - `find_keys(pattern)` - pattern matching with `*` wildcard
- ✅ Workspace integration: Uses `key_order` for insertion-order iteration, falls back to storage keys
- ✅ Lazy value access: Stores only keys, fetches values on-demand (memory efficient)
- ✅ Lifetime safety: Borrows engine immutably, multiple views can coexist
- ✅ Added 18 comprehensive unit tests (`tests/test_namespace_view.rs`, 372 LOC):
  - Metadata validation (context, namespace, entry_count, has_default)
  - Iterator correctness (entries, keys, values)
  - Access method validation (get, has_key, find_keys)
  - Edge cases (empty, nonexistent, multiple contexts)
  - Workspace ordering preservation (insertion order, NOT alphabetical)
  - Post-deletion consistency, update ordering stability
  - Bracket notation support, complex namespace paths
  - `.index` detection with multiple keys
- ✅ Comprehensive documentation added to `ENGINE_ENHANCEMENT.md` (~300 lines):
  - Complete API reference with examples
  - Implementation details (workspace ordering, lazy values, default detection)
  - Performance characteristics (time/space complexity)
  - Lifetime and borrowing semantics
  - Use cases (document export, namespace inspection, CLI enhancement)
  - Test coverage summary
- ✅ Exported `NamespaceView` from public API (`src/lib/types/meteor/mod.rs`)
- ✅ All 257 tests passing (239 existing + 18 new NamespaceView tests)
- ✅ Ready for CLI `list` command integration and document virtualization (DOC_VIRTUALIZATION_MODEL.md)
- ✅ **Cleanup**: Removed legacy `TokenBucket` code (262 LOC) to eliminate architectural confusion - MeteorEngine/StorageData is now the sole storage path

**ENG-12 (3 SP)** ✅ **COMPLETED** (2025-09-27)
- ✅ Implemented `cursor()` accessor method returning `Cursor<'_>`
- ✅ Created `Cursor` struct with context/namespace access and modification:
  - `context()` - read current context
  - `namespace()` - read current namespace
  - `set_context(impl Into<Context>)` - set context (accepts &str, String, Context)
  - `set_namespace(impl Into<Namespace>)` - set namespace (accepts &str, String, Namespace)
  - `reset()` - reset to defaults (app:main)
  - `position()` - formatted "context:namespace" string
- ✅ Implemented `cursor_guard()` method returning `CursorGuard` (RAII)
- ✅ Created `CursorGuard` with automatic cursor restoration:
  - Saves cursor state on creation
  - Restores state on drop (even on panic)
  - Works with early returns (`return`, `?`, `break`, `continue`)
  - Supports nested guards with correct restoration order
- ✅ Added `From<&str>` and `From<String>` implementations:
  - `Context::from(&str)` and `Context::from(String)` for ergonomic construction
  - `Namespace::from(&str)` and `Namespace::from(String)` for ergonomic construction
  - Enables `cursor.set_context("user")` without explicit type construction
- ✅ Added 18 comprehensive regression tests (`tests/test_cursor_guard.rs`, 307 LOC):
  - Cursor accessor tests (7 tests): basic operations, set_context/namespace, reset, position
  - Guard RAII tests (7 tests): basic restoration, nested guards, data operations, early return, panic safety, sequential guards, modified state preservation
  - Integration tests (4 tests): control commands, complex paths, combined cursor+guard usage, drop order verification
- ✅ Comprehensive documentation added to `ENGINE_ENHANCEMENT.md` (~260 lines):
  - Complete API reference with examples
  - Cursor and CursorGuard structure details
  - Flexible type conversion patterns (`Into<Context>`, `Into<Namespace>`)
  - Guard safety pattern and invariants (raw pointer usage, lifetime guarantees)
  - Performance characteristics (O(1) operations, memory usage)
  - Use cases (REPL commands, parser contexts, CLI display, panic-safe operations)
  - Test coverage summary
- ✅ Exported `Cursor` and `CursorGuard` from public API (`src/lib/types/meteor/mod.rs`)
- ✅ All 279 tests passing (257 existing + 18 new cursor tests + 4 new From<&str> conversions)
- ✅ ME-2 phase complete: 7/7 SP (100%) - All iterator and cursor guard infrastructure delivered
- ✅ Ready for CLI/REPL integration (REPL scratch commands, CLI status display, parser cursor guards)

---

## 🌠 ME-3 — METEOR AGGREGATION & VIRTUALIZATION (18 SP)

| Ticket | SP | Status | Owner | Dependencies | Acceptance Snapshot |
|--------|----|--------|-------|--------------|---------------------|
| ENG-20 | 3 | ✅ Complete | - | ME-2 | `meteors()` / `meteor_for()` produce grouped meteor views consumed by CLI/REPL. |
| ENG-21 | 2 | ✅ Complete | - | ENG-20 | Section/part emission honours ordering metadata; golden tests updated. |
| ENG-22 | 2 | ✅ Complete | - | ENG-20 | `export_namespace` supports text+JSON, captures metadata checksum. |
| ENG-23 | 2 | ✅ Complete | - | ENG-22 | `import_namespace` validates metadata, enforces invariant, reports diff. |
| ENG-24 | 2 | ✅ Complete | - | ENG-20 | `scratch_slot` API isolates workspace scratch areas with lifetime guard. |
| ENG-40 | 3 | ✅ Complete | - | ENG-20 | Meteor constructors enforce single `(context, namespace)`; legacy shims guarded. |
| ENG-41 | 2 | ✅ Complete | - | ENG-20 | Parsers align with grouped meteors; compatibility flag retains substring find. |
| ENG-42 | 1 | ✅ Complete | - | ME-2 | Central smart-split shared by parsers/CLI; regression covers quoting edge cases. |
| CLI-05 | 1 | ✅ Complete | - | ENG-20, ENG-22 | CLI `parse` routed through meteor views with text/json parity tests. |
| REPL-05 | 1 | ✅ Complete | - | ENG-20, ENG-24 | REPL `meteor/list/history` commands use new APIs; scripted test added. |
| QA-10  | 1 | ✅ Complete | - | ME-3 | Zero-warning baseline kept; CI guard fails on new warnings. |

**ENG-20 (3 SP)** ✅ **COMPLETED** (2025-09-27)
- ✅ Implemented `meteors()` iterator method returning `MeteorsIterator<'_>`
- ✅ Implemented `meteor_for(context, namespace)` accessor returning `Option<Meteor>`
- ✅ Created `MeteorsIterator<'a>` struct with lazy meteor construction:
  - Iterates contexts (sorted alphabetically)
  - Iterates namespaces within each context (sorted alphabetically)
  - Builds `Meteor` instances with tokens on-demand
  - Preserves workspace insertion order through `key_order` integration
  - Hybrid storage fallback when workspace unavailable
- ✅ Algorithm: O(total keys + C log C + N log N) where C=contexts, N=namespaces
- ✅ Integration with ME-2 infrastructure:
  - Uses `namespace_view()` from ENG-11 for ordered access
  - Leverages workspace `key_order` for deterministic iteration
  - Consistent ordering with `EntriesIterator` and `NamespaceView`
- ✅ Added 19 comprehensive integration tests (`tests/test_meteor_aggregation.rs`, 282 LOC):
  - `meteor_for()` tests (10 tests): basic, nonexistent, empty, workspace ordering, bracket keys, `.index` keys, token values
  - `meteors()` tests (9 tests): empty, single/multiple namespaces, multiple contexts, ordering preservation, deletions, updates, sorted contexts, consistency checks, multiple iterations
- ✅ Comprehensive documentation added to `ENGINE_ENHANCEMENT.md` (~250 lines):
  - Complete API reference with examples
  - MeteorsIterator structure and algorithm details
  - Integration strategy with ME-2 infrastructure
  - Performance characteristics (time/space complexity)
  - Use cases (CLI parse, REPL meteor command, export/import, view composition)
  - Test coverage summary
- ✅ Exported `MeteorsIterator` from public API (`src/lib/types/meteor/mod.rs`)
- ✅ All 309 tests passing (288 existing + 19 new meteor aggregation + 2 doc tests)
- ✅ Ready for CLI-05 (parse command) and REPL-05 (meteor/list commands) integration

**ENG-21 (2 SP)** ✅ **COMPLETED** (2025-09-27)
- ✅ Modified `Meteor::Display` trait to use `key_notation()` instead of `key().to_string()`:
  - **Before**: `token.key().to_string()` outputs transformed notation: `sections__i_intro`
  - **After**: `token.key_notation()` outputs original bracket notation: `sections[intro]`
- ✅ Workspace ordering preservation through token Vec:
  - `meteor_for()` uses `namespace_view().entries()` (ENG-11)
  - `entries()` leverages workspace `key_order` for insertion-order iteration (ENG-10)
  - Token Vec built in workspace order
  - Display serializes tokens in Vec order (preserves insertion order)
- ✅ Human-readable output for document/script virtualization:
  - Document sections: `doc:guides.install:sections[intro]=Welcome;sections[10_setup]=Step 1`
  - Shell script parts: `shell:setup.env:parts[env_check]=...;parts[install_pkg]=...`
  - Round-trip fidelity: `Meteor::parse(meteor.to_string())` preserves original keys
- ✅ Added 3 comprehensive tests (`tests/test_meteor_aggregation.rs`, +63 LOC):
  - `test_meteor_display_preserves_workspace_ordering` - Doc sections with insertion order
  - `test_shell_parts_display_preserves_ordering` - Shell script parts ordering
  - `test_meteors_iterator_display_with_sections` - Iterator display consistency
- ✅ Comprehensive documentation added to `ENGINE_ENHANCEMENT.md` (~160 lines):
  - Display trait changes with before/after examples
  - Ordering preservation mechanism
  - Document/script virtualization use cases
  - Integration with ENG-22/ENG-23 (export/import)
  - Benefits: human-readable output, filesystem export, round-trip fidelity
- ✅ All 22 tests passing in test_meteor_aggregation.rs (19 ENG-20 + 3 ENG-21)
- ✅ Total test count: 312 tests (309 existing + 3 new)
- ✅ Ready for ENG-22 (export_namespace) and ENG-23 (import_namespace) implementation

**ENG-22 (2 SP)** ✅ **COMPLETED** (2025-09-27)
- ✅ Implemented `export_namespace(context, namespace, format)` returning `Option<ExportData>`
- ✅ Created comprehensive export infrastructure:
  - `ExportData` struct with context, namespace, tokens, metadata, format
  - `ExportMetadata` with checksum validation, timestamp, token count
  - `ExportFormat` enum supporting Text and JSON formats
  - `ContentType` detection for bracket notation patterns (section[], part[], chunk[], function[], library[], module[], blob[])
- ✅ Content type system with singular forms for semantic clarity:
  - Document: `section[intro]`, `section[body]`, `full`, `metadata[type]`
  - Script: `part[header]`, `chunk[A18BfD]`, `function[parse]`, `library[utils]`, `module[parser]`, `blob[data]`, `raw`
  - Simple values: `port`, `debug`, `enabled` (no brackets)
- ✅ Export formats with round-trip fidelity:
  - Text format: Human-readable with headers and key=value pairs
  - JSON format: Structured with manual serialization (no serde dependency)
- ✅ Checksum validation using base64-encoded hash for integrity checking
- ✅ Integration with ME-2 infrastructure using `namespace_view()` for workspace ordering
- ✅ Implementation: `src/lib/types/meteor/export.rs` (470 LOC)
- ✅ Exported from public API: `ContentType`, `ExportFormat`, `ExportData`, `ExportMetadata`

**ENG-23 (2 SP)** ✅ **COMPLETED** (2025-09-27)
- ✅ Implemented `import_namespace(export_data)` returning `Result<ImportResult, MeteorError>`
- ✅ Created comprehensive import validation and diff tracking:
  - `ImportResult` with success status, token counts (added/updated/unchanged), diff tracking
  - `ImportDiff` enum for tracking changes: Added, Updated, Unchanged
  - Checksum validation for integrity verification
- ✅ Import features:
  - Validates export metadata and checksum integrity
  - Tracks detailed diff information for each token change
  - Updates existing tokens, adds new tokens, preserves unchanged tokens
  - Supports both Text and JSON import formats via `ExportData::from_text()` and `ExportData::from_json()`
- ✅ Round-trip validation: Export → Text/JSON → Import preserves all data
- ✅ Error handling for malformed import data, missing context/namespace, invalid checksums
- ✅ Integration with existing mutation paths using `set()` method
- ✅ Added 16 comprehensive tests (`tests/test_export_import.rs`, 280 LOC):
  - Export functionality: text/JSON formats, metadata validation, content type detection
  - Import functionality: validation, diff tracking, round-trip integrity
  - Edge cases: nonexistent namespaces, special characters, checksum changes
- ✅ Comprehensive documentation added to `ENGINE_ENHANCEMENT.md` (~370 lines):
  - Complete API reference with examples
  - Content type patterns and philosophy
  - Export/import workflow documentation
  - Use cases for document virtualization, backup/restore, data migration
- ✅ Total test count: 328 tests (312 existing + 16 new export/import tests)
- ✅ ME-3 export/import foundation complete, ready for ENG-24 (scratch slots)

**ENG-24 (2 SP)** ✅ **COMPLETED** (2025-09-28)
- ✅ Discovered workspace-backed scratch slots were already fully implemented with comprehensive RAII lifetime management
- ✅ Updated REPL mem commands to use scratch slot APIs instead of direct storage access:
  - `mem_set` → uses `engine.scratch_slot(name).persist()` with workspace backing
  - `mem_get` → accesses scratch slot data directly via `ScratchSlotGuard`
  - `mem_delete` → uses `engine.remove_scratch_slot()` for proper cleanup
  - `mem_list` → uses `engine.list_scratch_slots()` for workspace-ordered listing
  - `mem_edit` → full scratch slot API integration with RAII guards
- ✅ Comprehensive testing: 20 total tests (13 existing unit + 7 new integration tests)
- ✅ Implementation: `tests/test_scratch_slot_repl_integration_eng24.rs` (190 LOC integration tests)
- ✅ REPL integration validates:
  - Scratch slot lifecycle management through REPL operations
  - Multiple independent scratch slots working correctly
  - Persistence across other REPL operations without interference
  - Edge cases, error handling, and naming conventions
  - Zero breaking changes to existing REPL behavior
- ✅ Key features: RAII automatic cleanup, `.persist()` option, workspace integration, API consistency
- ✅ Files modified: `src/bin/repl.rs` (converted mem commands to scratch slot APIs)
- ✅ All tests passing: REPL scratch workflow properly wired to workspace-backed scratch slots
- ✅ Ready for ENG-40 (constructor hardening) and remaining ME-3 tasks

**ENG-42 (1 SP)** ✅ **COMPLETED** (2025-09-28)
- ✅ Created centralized smart-split implementation: `src/lib/parser/split.rs` (220 LOC)
- ✅ Consolidated three different smart-split implementations into single, configurable solution:
  - `SplitConfig` with behavior patterns: semicolon_tokens(), general_parsing(), meteor_streams(), meteor_delimiter()
  - `smart_split()` and `smart_split_borrowed()` for owned/borrowed string operations
  - `smart_split_multi_char()` for meteor delimiter (:;:) parsing
  - `smart_split_semicolons()` compatibility function for validators.rs
- ✅ Updated all parsers to use centralized logic:
  - `token_stream.rs` → `smart_split(input, SplitConfig::general_parsing(';'))`
  - `meteor_stream.rs` → `smart_split_multi_char(input, METEOR_DELIMITER, config)`
  - `validators.rs` → `crate::parser::split::smart_split_semicolons(s)`
- ✅ Fixed Unicode handling issues: proper byte boundary management prevents panics on Unicode strings
- ✅ Comprehensive regression testing: `tests/test_split_regression_eng42.rs` (12 tests, 285 LOC)
  - Escaped quotes in various contexts, control tokens, bracket notation
  - Meteor format compliance, Unicode handling, performance with large inputs
  - Legacy compatibility validation, error handling edge cases
- ✅ Zero breaking changes: all existing parser behavior preserved
- ✅ All tests passing: centralized split logic with robust edge case coverage

**ENG-40 (3 SP)** ✅ **COMPLETED** (2025-10-05)
- ✅ Routed all meteor construction through the hardened `Meteor::try_new*` APIs so mixed-context/namespace data now raises `MeteorError` instead of silently mutating storage.
- ✅ Updated CLI/REPL storage helpers to keep bracket notation intact when persisting aggregated meteors, maintaining human-readable output and workspace ordering.
- ✅ Expanded parser-alignment tests to cover bracket notation and error propagation from the strict constructors.

**ENG-41 (2 SP)** ✅ **COMPLETED** (2025-10-05)
- ✅ Rewrote `TokenStreamParser::process` and `MeteorStreamParser::process` to delegate to the aggregation pipelines, ensuring CLI/REPL, export/import, and tests all share the same grouping semantics.
- ✅ Added control-command handling (`ctl:`, `ns=`, `ctx=`) to the aggregation path so legacy scripts keep working while benefiting from strict validation.
- ✅ Documented the unified CLI output formats (text + JSON) in `ENGINE_ENHANCEMENT.md` and clarified meteor-stream requirements in `STREAM_ARCHITECTURE.md`.

**QA-10 (1 SP)** ✅ **COMPLETED** (2025-10-05)
- ✅ Restored a zero-warning build by tightening parser tests, gating unused workspace helpers, and moving `serde_json` into runtime dependencies for the CLI.
- ✅ Verified clean `cargo test` runs (including sanity parity suites) to back the CI guard that fails on compiler warnings.

**CLI-05 (1 SP)** ✅ **COMPLETED** (2025-09-28)
- ✅ Updated CLI parse command to use meteor view APIs instead of direct storage access
- ✅ Modified `print_text_engine_output` and `print_json_engine_output` functions:
  - Replaced `storage.get_all_keys_in_namespace()` with `engine.namespace_view()` calls
  - Leveraged `NamespaceView.entries()` for workspace-ordered iteration
  - Maintained consistent ordering across text and JSON output formats
- ✅ Comprehensive parity testing: `tests/test_cli_output_parity_eng42.rs` (8 tests, 270 LOC)
  - Text/JSON output consistency validation
  - Complex meteor streams with quotes and special characters
  - Bracket notation handling, control token processing
  - Workspace ordering preservation, error handling parity
- ✅ Files modified: `src/bin/cli.rs` (updated output functions to use NamespaceView APIs)
- ✅ All tests passing: CLI parse command properly uses meteor view infrastructure

**REPL-05 (1 SP)** ✅ **COMPLETED** (2025-09-28)
- ✅ Updated REPL commands to use meteor view APIs for workspace-ordered iteration:
  - `handle_list()` → uses `engine.namespace_view()` instead of direct storage
  - `render_engine()` → uses `NamespaceView.entries()` for consistent ordering
  - `mem_list()` → converted to scratch slot APIs (as part of ENG-24 integration)
- ✅ Comprehensive scripted testing: `tests/test_repl_functionality_eng42.rs` (10 tests, 290 LOC)
  - Basic parse and state operations, list command functionality
  - Context and namespace commands, CRUD operations
  - Memory/scratch functionality, token parsing, validation
  - Bracket notation support, workspace ordering consistency
- ✅ Files modified: `src/bin/repl.rs` (updated to use NamespaceView APIs)
- ✅ All tests passing: REPL commands properly use meteor view infrastructure
- ✅ Integrated with ENG-24: REPL scratch functionality uses workspace-backed scratch slots

## 🛰️ ME-4 — Parsing & Query Polish (10 SP)

| Ticket | SP | Status | Owner | Dependencies | Acceptance Snapshot |
|--------|----|--------|-------|--------------|---------------------|
| ENG-30 | 3 | 🔵 Ready | - | ME-3 | Path parser module yields structured errors (position/type) consumed by CLI/REPL. |
| ENG-31 | 2 | 🔵 Ready | - | ENG-30 | Workspace-backed glob/prefix queries replace legacy substring search with compatibility toggle. |
| ENG-32 | 2 | 🔵 Ready | - | ENG-20, ENG-42 | Complete smart-split consolidation; remove remaining ad-hoc splitters/tests updated. |
| ENG-33 | 3 | 🔵 Ready | - | ENG-40 | Introduce `EngineSetOptions` so setters can opt into strict validation (namespace depth, reserved tokens). |

**Acceptance Focus**: Consistent structured errors surfaced in CLI/REPL, workspace cache powers glob/prefix queries, single smart-split implementation across codebase, strict-mode setters toggleable without forked logic.

---

## 📌 TRACKERS & FOLLOW-UPS
- **Testing Expansion**: TEST-01..03, REGR-01 remain queued for ME-4 once parser/path updates land.
- **Documentation**: ENG-90..92 will refresh architecture guides with the new error surfaces after ENG-30/31.
- **Integration**: ProntoDB contract review scheduled post ENG-31 to validate glob/prefix query semantics.

Last Updated: 2025-10-05
