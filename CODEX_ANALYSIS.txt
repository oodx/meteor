Hybrid Storage Review Findings
==============================

Blocking Issues
---------------

1. Meteor path parsing still assumes "context:key" format for two-part paths.
   - Evidence: `parse_meteor_path` treats any two-component path as `(context, "main", key)` (`src/lib/types/meteor/engine.rs:355-362`).
   - Impact: Directory queries like `engine.is_directory("user:settings")` are routed to the `main` namespace, so the tree lookup misses the `settings` namespace entirely and returns `false`, matching the failing test output.
   - Fix: Update the parser so that `"context:namespace"` resolves to `(context, namespace, "")`. Only treat the second segment as a key when a real namespace is intentionally omitted (e.g., require an explicit placeholder such as `context::key`).

2. Single-segment paths default to the wrong context and cannot express directory roots.
   - Evidence: The same parser hard-codes `(app, main, <segment>)` for one-part inputs (`src/lib/types/meteor/engine.rs:355-357`).
   - Impact: Calls like `engine.has_default("user")` look under the `app` context instead of `user`, so directory default lookups can never succeed even after writing `engine.set("user:index", ..)` (`tests/test_engine_hybrid.rs:23-28`).
   - Fix: Treat a single identifier as a context-level directory (`(segment, "main", "")`) so that the `.index` helper in `ContextStorage::has_default` (`src/lib/types/meteor/storage_data.rs:108-117`) sees the expected canonical key.

Secondary Observations
----------------------

- The hybrid tree indexing in `StorageData` correctly builds namespace roots (`StorageData::set` → `ContextStorage::update_tree_index`), so once the parser delivers the right namespace/path tuple the directory checks should pass without further changes.

ENGINE Tasks
------------

- ENGINE-01: Adjust `parse_meteor_path` to return `(context, namespace, "")` for two-part inputs and `(context, "main", "")` for single-part inputs, preserving the explicit empty-namespace form via `context::key` (`src/lib/types/meteor/engine.rs`).
- ENGINE-02: Add regression coverage that exercises `is_directory("context:namespace")`, `has_default("context")`, and the `context::key` empty-namespace case to guard the parser semantics (`tests/test_engine_hybrid.rs` or a dedicated unit test module).
- ENGINE-03: Audit documentation and examples for dot-delimited meteor paths and align them with the colon-based addressing now enforced by the parser (`docs/README.md`, `docs/ref/architecture/HYBRID_STORAGE_ARCHITECTURE.md`, and related guides).

Testing Infrastructure Findings
===============================

1. `bin/test.sh` advertises RSB flags that are never consumed.
   - Evidence: Flags like `--comprehensive`, `--benchmark`, and `--sleep` toggle shell variables that are never read afterwards (`bin/test.sh:19-71`), so they silently do nothing.
   - Impact: Developers believe different suites or pacing modes exist, but every invocation ultimately calls the same `cargo test` commands.

2. The test matrix points at files that do not exist.
   - Evidence: Entries such as `validation → validation.rs` and `all → all.sh` lack corresponding files under `tests/` (`bin/test.sh:37-56` vs. `tests/validation/`, `tests/all.sh`). The runner exits with "Test file not found" when those targets are requested.
   - Impact: The documented RSB categories (validation, comprehensive, integration, performance) are dead links, preventing those suites from ever being exercised.

3. Integration tests are wrapped in `#[cfg(test)] mod tests` blocks, so the harness executes zero assertions.
   - Evidence: Files like `tests/sanity.rs` and `tests/uat.rs` gate all tests behind `#[cfg(test)]`, but integration crates are built without that configuration flag; invoking `cargo test --test sanity` reports `running 0 tests` (see `tests/sanity.rs:15-118`).
   - Impact: The majority of our sanity/UAT suites never run, masking numerous regressions (for example, these files still assert dot-based paths such as `engine.get("app.main.host")`).

4. Support scripts in `tests/sanity/` invoke non-existent binaries.
   - Evidence: `tests/sanity/run.sh` calls `cargo test --test sanity_meteor`, `sanity_rsb_fs`, etc. (`tests/sanity/run.sh:19-102`), but no such integration test crates exist.
   - Impact: Anyone using the helper script encounters immediate failures, and the automation pipeline cannot rely on it.

5. New hybrid storage coverage is not wired into the official runner.
   - Evidence: `tests/test_engine_hybrid.rs` holds the failing hybrid directory assertion, but `bin/test.sh` never invokes it, so the unified interface misses the regression entirely.

TEST Tasks
----------

- TEST-01: Rework the integration test layout so tests are defined at crate root (no `#[cfg(test)]` gating) and update expectations to the colon-based API (`tests/sanity.rs`, `tests/uat.rs`, and derivative modules).
- TEST-02: Bring `bin/test.sh` and `tests/sanity/run.sh` in sync with reality—remove unused flag plumbing, prune or implement missing suites, and ensure each advertised alias maps to an actual `cargo test` target (`bin/test.sh`, `tests/sanity/run.sh`).
- TEST-03: Expose the hybrid storage regression suite through the primary runner (e.g., add a `hybrid` target that runs `cargo test --test test_engine_hybrid`) so the failing directory behavior is visible in CI (`bin/test.sh`, `tests/test_engine_hybrid.rs`).

Testing Reference
-----------------

- `cargo test test_meteor_engine_hybrid_storage_methods` currently fails at `tests/test_engine_hybrid.rs:18` because `engine.is_directory("user:settings")` is routed to the wrong namespace.
- `cargo test --test sanity` fails to compile due to missing `parse_meteor_path_for_directory` helper, underscoring that the advertised sanity suite is neither build- nor run-ready.
